<section class="container">
    <div class="tituloconteudo">
        <h1><?php echo $obj->titulodavaga; ?></h1>
        <svg id="progress-steps" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 705 26">
            <defs>
                <linearGradient id="linear-gradient" x1="1" y1="1" x2="0" y2="1" gradientUnits="objectBoundingBox">
                <stop offset="0" stop-color="#116cdd"/>
                <stop offset="1" stop-color="#116cdd" stop-opacity="0"/>
                </linearGradient>
            </defs>
            <g id="Group_2939" data-name="Group 2939" transform="translate(-670 -106)">
                <g id="Group_2938" data-name="Group 2938">
                <g id="progress-steps" transform="translate(670 106)">
                    <g id="step3" transform="translate(420.819 -6)">
                    <g id="Ellipse" transform="translate(6.181 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                        <circle cx="13" cy="13" r="13" stroke="none"/>
                        <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_4" data-name="4" transform="translate(19.181 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">4</tspan></text>
                    </g>
                    <g id="step3-2" data-name="step3" transform="translate(164.819 -6)">
                    <g id="Ellipse-2" data-name="Ellipse" transform="translate(136.181 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                        <circle cx="13" cy="13" r="13" stroke="none"/>
                        <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_3" data-name="3" transform="translate(149.181 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">3</tspan></text>
                    </g>
                    <g id="step3-3" data-name="step3" transform="translate(503.819 -6)">
                    <g id="Ellipse-3" data-name="Ellipse" transform="translate(49.181 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                        <circle cx="13" cy="13" r="13" stroke="none"/>
                        <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_5" data-name="5" transform="translate(62.181 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">5</tspan></text>
                    </g>
                    <g id="step3-4" data-name="step3" transform="translate(168.603 -6)">
                    <g id="Ellipse-4" data-name="Ellipse" transform="translate(6.397 6)" fill="#116cdd" stroke="#116cdd" stroke-width="2">
                        <circle cx="13" cy="13" r="13" stroke="none"/>
                        <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_2" data-name="2" transform="translate(19.397 24)" fill="#fff" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">2</tspan></text>
                    </g>
                    <g id="step3-5" data-name="step3" transform="translate(43.001 -6)">
                    <g id="Ellipse-5" data-name="Ellipse" transform="translate(5.999 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                        <circle cx="13" cy="13" r="13" stroke="none"/>
                        <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_1" data-name="1" transform="translate(18.999 24)" fill="#a5a4bf" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">1</tspan></text>
                    </g>
                    <g id="step4" transform="translate(673 -6)">
                    <g id="Ellipse-6" data-name="Ellipse" transform="translate(6 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                        <circle cx="13" cy="13" r="13" stroke="none"/>
                        <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_6" data-name="6" transform="translate(19 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">6</tspan></text>
                    </g>
                    <rect id="Rectangle_1763" data-name="Rectangle 1763" width="100" height="2" transform="translate(75 12)" fill="#116cdd"/>
                    <rect id="Rectangle_1767" data-name="Rectangle 1767" width="49" height="2" transform="translate(0 12)" fill="url(#linear-gradient)"/>
                    <rect id="Rectangle_1765" data-name="Rectangle 1765" width="100" height="2" transform="translate(327 12)" fill="#a5a4bf" opacity="0.5"/>
                    <rect id="Rectangle_2042" data-name="Rectangle 2042" width="100" height="2" transform="translate(201 12)" fill="#a5a4bf" opacity="0.5"/>
                    <rect id="Rectangle_1766" data-name="Rectangle 1766" width="100" height="2" transform="translate(453 12)" fill="#a5a4bf" opacity="0.5"/>
                    <rect id="Rectangle_2043" data-name="Rectangle 2043" width="100" height="2" transform="translate(579 12)" fill="#a5a4bf" opacity="0.5"/>
                </g>
                <g id="progress-completed" transform="translate(719 106)">
                    <g id="Ellipse-7" data-name="Ellipse" fill="#f0f0f7" stroke="#116cdd" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <path id="Path_294" data-name="Path 294" d="M1187.471,717.879l4.9,4.833,8.407-8.4" transform="translate(-1181 -705)" fill="none" stroke="#116cdd" stroke-width="2"/>
                </g>
                </g>
            </g>
        </svg>
    </div>
    <div class="telaestrutura">
        <div class="painelPrincipal">
            <div class="cardconteudo">
                <form id="frmvaga" action="<?php echo site_url('vaga/dadosdavaga') ?>" method="POST">
                    <input id="idvaga" name="idvaga" type="hidden" value="<?php echo $obj->idvaga; ?>">
                    <input id="idcliente" name="idcliente" type="hidden" value="<?php echo $obj->idcliente; ?>">
                    <input id="fasecadastro" name="fasecadastro" type="hidden" value="3">                    
                    <div id="dadosform" class="corpoconteudo">
                        <div class="texto">
                            <h2>Informações sobre a vaga</h2>
                            <div class="caixa meio">
                                <label for="idarea">Área</label>
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Selecione a área de atuação desta vaga.
                                        <ins></ins>
                                    </span>
                                </div>
                                <select id="idarea" name="idarea" onchange="BuscarSubarea(this);">
                                    <?php echo $obj->GerarOpcoesAreas($obj->idarea, __("-- Selecione --")); ?>
                                </select>
                            </div>
                            <div class="caixa meio ES">
                                <label for="idnivel">Nível</label>
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Selecione o nível hierárquico desta vaga.
                                        <ins></ins>
                                    </span>
                                </div>
                                <select id="idnivel" name="idnivel">
                                    <?php echo $obj->GerarOpcoesNiveis($obj->idnivel, __("-- Selecione --")); ?>
                                </select>
                            </div>
                            <div class="caixa full">
                                <div class="lista" id="areasubarea" style="display: none;">
                                </div>
                                <label for="idsubarea">Subárea
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Selecione a subárea de atuação desta vaga.
                                        <ins></ins>
                                    </span>
                                </div></label>
                                <select id="subarea" name="subarea" onchange="AdicionarSubareaVaga(null);">
                                    <?php echo $obj->GerarOpcoesSubareas("", __("-- Selecione --")); ?>
                                </select>
                            </div>
                            <div class="cubo">
                                <div class="caixa full">
                                    <label for="nomecargo">Selecionar cargos mais próximos (correlatos) existentes no mercado</label>
                                    <div class="info">
                                        <i class="fa fa-info-circle"></i>
                                        <span>
                                            Digite o nome do cargo correlatos existentes no mercado e clique em adicionar para incluir o cargo na lista de cargos.
                                            <ins></ins>
                                        </span>
                                    </div>
                                    <div class="lista" id="areacargo" style="display: none;">
                                    </div>
                                    <input class="add" id="nomecargo" name="nomecargo" type="text" value="">
                                    <button class="add" type="button" onclick="AdicionarCargoCorrelato()" title="Adicionar cargo">
                                        <i class="fa fa-plus-circle"></i>
                                    </button>
                                </div>
                                <div class="caixa">
                                    <label for="linhadereporte">Linha de reporte</label>
                                    <div class="info">
                                        <i class="fa fa-info-circle"></i>
                                        <span>
                                            Para qual nível essa posição irá reportar.
                                            <ins></ins>
                                        </span>
                                    </div>
                                    <select id="linhadereporte" name="linhadereporte">
                                        <?php echo $obj->GerarOpcoesLinhadereporte($obj->linhadereporte, __("-- Selecione --")); ?>
                                    </select>
                                </div>
                                <div class="caixa">
                                    <label for="faixaderemuneracaoinicial">Faixa de remuneração mensal</label>
                                    <div class="info">
                                        <i class="fa fa-info-circle"></i>
                                        <span>
                                            Faixa de remuneração mensal
                                            <ins></ins>
                                        </span>
                                    </div>
                                    <div class="caixabaixa">
                                        <span>Inicial: R$</span>
                                        <input id="faixaderemuneracaoinicial" name="faixaderemuneracaoinicial" type="text" value="<?php echo $obj->faixaderemuneracaoinicial; ?>">
                                    </div>
                                    <div class="caixabaixa ES">
                                        <span>Final: R$</span>
                                        <input id="faixaderemuneracaofim" name="faixaderemuneracaofim" type="text" value="<?php echo $obj->faixaderemuneracaofim; ?>">
                                    </div>
                                </div>
                            </div>
                            <div class="cubo  ES">
                                <div class="caixa">
                                    <label for="descricaodavaga">Descrição da vaga</label>
                                    <div class="info">
                                        <i class="fa fa-info-circle"></i>
                                        <span>
                                            informe a descrição da vaga.
                                            <ins></ins>
                                        </span>
                                    </div>
                                    <textarea id="descricaodavaga" name="descricaodavaga"><?php echo $obj->descricaodavaga; ?></textarea>
                                </div>
                            </div>
                            <h2 style="display: none;">Competências essenciais ou desejáveis </h2> 
                            <h4 class="mb-20" style="display: none;">
                                Escolha quais competências os candidatos devem ter para satisfazer a posição.
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Você deve digitar o nome da competência que o sistema irá te apresentar uma lista de competências, clique em uma competência para adicioná-la a lista.
                                        <ins></ins>
                                    </span>
                                </div>
                            </h4>
                            <div class="caixa full" style="display: none; margin-bottom: 10px;">
                                <div id="contenercompetencias" class="lista incluir">
                                </div>
                            </div>
                            <div id="listaidcompetencia" class="caixa full" style="display: none;">
                                <select id="competencia" name="competencia" onchange="AdicionarCompetenciaCorrelata(null);">
                                    <?php echo $obj->GerarOpcoesCompetencias("", __("-- Selecione --")); ?>
                                </select>
                                <samp class="OU">OU</samp>
                                <button type="button" id="btn-proup-lista" onclick="ShowLista()" style="float:left;margin: 8px 0px 0px;"><i class="fa fa-list-alt"></i> Visualizar lista de competências</button>
                            </div>
                            <h2>
                                <span style="float: left; position: relative;">
                                    Local do trabalho
                                </span>
                                <div class="remoto">
                                    <input id="remoto" name="remoto" type="checkbox" value="Sim" <?php echo $obj->FormGetRadio("remoto","Sim"); ?>>
                                    <samp>Esta vaga é remota</samp>
                                </div>
                            </h2>
                            <div class="caixa meio-20">
                                <label for="idestado">Estado</label>
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Selecione o estado da vaga.
                                        <ins></ins>
                                    </span>
                                </div>
                                <select id="idestado" name="idestado">
                                    <?php echo $obj->GerarOpcoesEstados($obj->idestado, __("-- Selecione --")); ?>
                                </select>
                            </div>
                            <div class="caixa meio-40">
                                <label for="idcidade">Cidade</label>
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Selecione a cidade da vaga.
                                        <ins></ins>
                                    </span>
                                </div>
                                <select id="idcidade" name="idcidade">
                                    <?php echo $obj->GerarOpcoesCidades($obj->idcidade, __("-- Selecione --")); ?>
                                </select>
                            </div>
                            <div class="caixa meio-40 ES">
                                <label for="raiodepesquisa">Candidatos no raio de:</label>
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Selecione um raio de pesquisa em torno da cidade selecionada.
                                        <ins></ins>
                                    </span>
                                </div>
                                <select id="raiodepesquisa" name="raiodepesquisa">
                                    <?php echo $obj->GerarOpcoesRaiodepesquisa($obj->raiodepesquisa, __("-- Selecione --")); ?>
                                </select>
                            </div>
                            <h4>
                                Mobilidade: Considerar candidatos fora do raio de atuação do local de trabalho?
                                <div class="info">
                                    <i class="fa fa-info-circle"></i>
                                    <span>
                                        Considerar a mobilidade do candidatos fora do raio de atuação do local de trabalho.
                                        <ins></ins>
                                    </span>
                                </div>
                            </h4>
                            <ul class="mb-40">
                                <li class="meio">
                                    <input id="mobilidade1" name="mobilidade" type="radio" value="Apenas no raio do local de trabalho" <?php echo $obj->FormGetRadio("mobilidade","Apenas no raio do local de trabalho"); ?>>
                                    <span>
                                        Apenas no raio do local de trabalho
                                    </span>
                                </li>
                                <li class="meio">
                                    <input id="mobilidade3" name="mobilidade" type="radio" value="De todo o Brasil, mas desde que o(a) candidato(a) teve/tenha algum vínculo pessoal com a cidade/Estado do local de trabalho" <?php echo $obj->FormGetRadio("mobilidade","De todo o Brasil, mas desde que o(a) candidato(a) teve/tenha algum vínculo pessoal com a cidade/Estado do local de trabalho"); ?>>
                                    <span>
                                        De todo o Brasil, mas desde que o(a) candidato(a) teve/tenha algum vínculo pessoal com a cidade/Estado do local de trabalho
                                    </span>
                                </li>
                                <li class="meio">
                                    <input id="mobilidade2" name="mobilidade" type="radio" value="De todo o Estado do local de trabalho" <?php echo $obj->FormGetRadio("mobilidade","De todo o Estado do local de trabalho"); ?>>
                                    <span>
                                        De todo o Estado do local de trabalho
                                    </span>
                                </li>
                                <li class="meio">
                                    <input id="mobilidade4" name="mobilidade" type="radio" value="De todo o Brasil, pois a empresa considera mobilidade total" <?php echo $obj->FormGetRadio("mobilidade","De todo o Brasil, pois a empresa considera mobilidade total"); ?>>
                                    <span>
                                        De todo o Brasil, pois a empresa considera mobilidade total
                                    </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </form>
            </div>
            <div id="dadosformrodape" class="rodapeconteudo">
                <div class="area-btn">
                    <a href="javascript:;" class="btn-Voltar" onclick="Voltar()">Voltar</a>
                    <a href="javascript:;" class="btn-Avancar" onclick="SalvarVaga()">Salvar e Avançar</a>
                </div>
            </div>
        </div>
        <div class="textoAjuda cardEstrutura">
            <h2>Detalhes da vaga</h2>
            <p>Nesta etapa vamos entender características e  desafios da vaga, além de competências que os candidatos devem ter para satisfazer à necessidade desta posição.</p>
            <p>Sabemos que para muitas empresas a flexibilidade e formatos remotos de atuação são uma realidade.<br/> No seu caso específico, precisamos entender se o profissional irá trabalhar remoto ou de quais regiões faz sentido apresentarmos candidatos.</p>
            <p>Todos esses aspectos poderão ser levados em conta na análise do algoritmo de seleção para apresentar a melhor lista de candidatos aderentes ao que você busca.</p>
            <p>Em caso de dúvidas no preenchimento deste formulário você pode nos contatar no <a href="mailto:ajuda@candidatoagora.com.br">ajuda@candidatoagora.com.br</a>. <br/>Retornaremos o contato em breve.</p>
        </div>
    </div>
</section>
<div id="OcultarSetor" style="display: none;">
<!--
<div id="caixasetor1">
    <ul id="ULsetor1" class="up">
    </ul>
</div>
-->
</div>
<div id="OcultarSubareaVaga" style="display: none;">
<!--
<div class="bola" id="Subarea{idsubarea}">
    <input id="idsubareavaga{cont}" name="idsubareavaga[]" type="hidden" value="{idsubareavaga}">
    <input id="idsubarea{cont}" name="idsubarea[]" type="hidden" value="{idsubarea}">
    <span>{subarea}</span>
    <a href="javascript:;" class="btn-close" onclick="DeletarSubareaVaga(this, {idsubareavaga})"><i class="fa fa-remove"></i></a>
</div>
-->
</div>
<div id="OcultarCompetenciaCorrelata" style="display: none;">
<!--
<div class="bola" id="Competencia{idcompetencia}">
    <input id="idcompetenciacorrelata{idcompetencia}" name="idcompetenciacorrelata[]" type="hidden" value="{idcompetenciacorrelata}">
    <input id="idcompetencia{idcompetencia}" name="idcompetencia[]" type="hidden" value="{idcompetencia}">
    <span>{competencia}</span>
    <a href="javascript:;" class="btn-close" onclick="DeletarCompetenciaCorrelata(this, {idcompetenciacorrelata})"><i class="fa fa-remove"></i></a>
</div>
-->
</div>
<div id="OcultarCargoCorrelato" style="display: none;">
<!--
<div class="bola" id="Cargo{cont}">
    <input id="idcargocorrelato{cont}" name="idcargocorrelato[]" type="hidden" value="{idcargocorrelato}">
    <input id="cargo{cont}" name="cargo[]" type="hidden" value="{cargo}">
    <span>{cargo}</span>
    <a href="javascript:;" class="btn-close" onclick="DeletarCargoCorrelato(this, {idcargocorrelato})"><i class="fa fa-remove"></i></a>
</div>
-->
</div>
<div id="OcultarCompetenciaCorrelataLista" style="display: none;">
<!--
<li id="Competencia{idcompetencia}" class="bola" data-competencia="{competencia}">
    <input id="idcompetenciacorrelata{idcompetencia}" name="idcompetenciacorrelata[]" type="hidden" value="{idcompetenciacorrelata}">
    <input id="idcompetencia{idcompetencia}" name="idcompetencia[]" type="checkbox" {checked} value="{idcompetencia}">
    <input id="idarea{idcompetencia}" name="idarea[]" type="hidden" value="{idarea}">
    <span>
        {competencia}
    </span>
</li>
-->
</div>
<script>
    var templatesubareavaga = null;
    var templatecargocorrelato = null;
    var templatecompetenciacorrelata = null;
    var templatecompetenciacorrelatalista = null;
    function GetTemplateSubareaVaga()
    {    
		if(Vazio(templatesubareavaga))
        {
            templatesubareavaga = $("#OcultarSubareaVaga").html();
        }
        return templatesubareavaga;
    }
    function AdicionarSubareaVaga(subareavaga = null)
    {      
        let obj = $("#areasubarea div:last-of-type");
        let id = 0;
        let nome = "Subarea";
        if(Vazio(obj))
        {
            id = 0;
        }
        else
        {
            id = obj.attr('id');
            id = GetNumero(id);
            id++;
		}
		if(Vazio(subareavaga))
        {
            let idsubarea = $("#subarea").val();
            let subarea = $("#subarea option:selected").html();
            if(Vazio(idsubarea))
            {
                return;
            }
            subareavaga = {
                "idsubareavaga":0,
                "idsubarea": idsubarea,
                "subarea": subarea
            };
            $("#subarea").val("");
        }
        obj = $("#areasubarea");  
        let caixa = GetTemplateSubareaVaga();
        if(Vazio(obj))
        {
            return;
        }
        nome += subareavaga.idsubarea;
        if($(nome).length > 0)
        {
            return;
        }
        obj.css("display","block");
        caixa = caixa.replaceAll("{cont}", id);
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
        caixa = caixa.replaceAll("{idsubareavaga}", subareavaga.idsubareavaga);
        caixa = caixa.replaceAll("{idsubarea}", subareavaga.idsubarea);
        caixa = caixa.replaceAll("{subarea}", subareavaga.subarea);
        obj.append(caixa);
    }
    function CarregarMaisSubareaVaga(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaissubareavaga");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarSubareaVaga(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMaisSubareaVaga(data.posicao, data.total);
                    }
                }
                else
                {
                    console.log(data);
                    /*msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);*/
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de subarea.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function DeletarSubareaVaga(obj, idsubareavaga)
    {
        let url = GetUrlAcao("api","deletesubareavaga");
        let data = null;
        if(Vazio(idsubareavaga))
        {
            $(obj).parent().remove();
            return;
        }
        if(!confirm("<?php echo __("Tem certeza que deseja deletar esta subarea da sua vaga?"); ?>"))
        {
            return;
        }
        data = {
            "idsubareavaga":idsubareavaga
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    $(obj).parent().remove();
                    msn = data.mensagem;
                    titulo = data.titulo;
                    MsnSucesso(titulo, msn);
                }
                else
                {
                    msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao deletar esta subarea da sua vaga.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function BuscarSubarea(obj = null)
    {
        let url = GetUrlAcao("api","listasubareas");
        let data = null;
        let idarea = $(obj).val();
        let msn = "";
        if(Vazio(idarea))
        {
            return;
        }
        data = {
            "idarea":idarea
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    let html = '<option value=""><?php echo __("-- Selecione --"); ?></option>';
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            id = data.lista[i].id;
                            texto = data.lista[i].texto;
                            html += `<option value="${id}">${texto}</option>`;
                        }
                    }
                    $("#subarea").html(html);
                }
                else
                {
                    let html = '<option value=""><?php echo __("-- Selecione --"); ?></option>';
                    $("#subarea").html(html);
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de cidade.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function GetTemplateCargoCorrelato()
    {    
		if(Vazio(templatecargocorrelato))
        {
            templatecargocorrelato = $("#OcultarCargoCorrelato").html();
        }
        return templatecargocorrelato;
    }
    function AdicionarCargoCorrelato(cargo = null)
    {      
        let obj = $("#areacargo div:last-of-type");
        let id = 0;
        if(Vazio(obj))
        {
            id = 0;
        }
        else
        {
            id = obj.attr('id');
            id = GetNumero(id);
            id++;
		}
		if(Vazio(cargo))
        {
            let nome = $("#nomecargo").val();
            if(Vazio(nome))
            {
                return;
            }
            cargo = {
                "idcargocorrelato":0,
                "idvaga": 0,
                "cargo": nome
            };
            $("#nomecargo").val("");
        }
        obj = $("#areacargo");  
        let caixa = GetTemplateCargoCorrelato();
        if(Vazio(obj))
        {
            return;
        }
        obj.css("display","block");
        caixa = caixa.replaceAll("{cont}", id);
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
		caixa = caixa.replaceAll("{idcargocorrelato}", cargo.idcargocorrelato);
        caixa = caixa.replaceAll("{cargo}", cargo.cargo);
        obj.append(caixa);
    }
    function CarregarMaisCargo(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaiscargoscorrelato");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarCargoCorrelato(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMaisCargo(data.posicao, data.total);
                    }
                }
                else
                {
                    console.log(data);
                    /*msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);*/
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de cargo correlato.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function DeletarCargoCorrelato(obj, idcargocorrelato)
    {
        let url = GetUrlAcao("api","deletecargocorrelato");
        let data = null;
        if(Vazio(idcargocorrelato))
        {
            $(obj).parent().remove();
            return;
        }
        if(!confirm("<?php echo __("Tem certeza que deseja deletar esta cargo correlato da sua vaga?"); ?>"))
        {
            return;
        }
        data = {
            "idcargocorrelato":idcargocorrelato
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    $(obj).parent().remove();
                    msn = data.mensagem;
                    titulo = data.titulo;
                    MsnSucesso(titulo, msn);
                }
                else
                {
                    msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao deletar esta cargo correlato da sua vaga.";
                MsnDanger("Erro", msn);
            }
        });
    }    
    function GetTemplateCompetenciaCorrelata()
    {    
		if(Vazio(templatecompetenciacorrelata))
        {
            templatecompetenciacorrelata = $("#OcultarCompetenciaCorrelata").html();
        }
        return templatecompetenciacorrelata;
    }
    function AdicionarCompetenciaCorrelata(competenciacorrelata = null)
    {
        let nome = "#contenercompetencias #Competencia";
		if(Vazio(competenciacorrelata))
        {
            let idcompetencia = $("#competencia").val();
            let competencia = $("#competencia option:selected").html();
            if(Vazio(idcompetencia))
            {
                return;
            }
            competenciacorrelata = {
                "idcompetenciacorrelata":0,
                "idcompetencia": idcompetencia,
                "competencia": competencia
            };
            $("#competencia").val("");
        }
        obj = $("#contenercompetencias");  
        let caixa = GetTemplateCompetenciaCorrelata();
        if(Vazio(obj))
        {
            return;
        }
        nome += competenciacorrelata.idcompetencia;
        if($(nome).length > 0)
        {
            return;
        }
        obj.css("display","block");
        obj.parent().css("display","block");
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
        caixa = caixa.replaceAll("{idcompetenciacorrelata}", competenciacorrelata.idcompetenciacorrelata);
        caixa = caixa.replaceAll("{idcompetencia}", competenciacorrelata.idcompetencia);
        caixa = caixa.replaceAll("{competencia}", competenciacorrelata.competencia);
        obj.append(caixa);
    }
    function CarregarMaisCompetenciaCorrelata(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaiscompetenciacorrelata");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
            "somarcado": 1
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarCompetenciaCorrelata(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMaisCompetenciaCorrelata(data.posicao, data.total);
                    }
                }
                else
                {
                    console.log(data);
                    /*msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);*/
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de competência.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function DeletarCompetenciaCorrelata(obj, idcompetenciacorrelata)
    {
        let url = GetUrlAcao("api","deletecompetenciacorrelata");
        let data = null;
        if(Vazio(idcompetenciacorrelata))
        {
            $(obj).parent().remove();
            return;
        }
        if(!confirm("<?php echo __("Tem certeza que deseja deletar esta competência da sua vaga?"); ?>"))
        {
            return;
        }
        data = {
            "idcompetenciacorrelata":idcompetenciacorrelata
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    $(obj).parent().remove();
                    msn = data.mensagem;
                    titulo = data.titulo;
                    MsnSucesso(titulo, msn);
                }
                else
                {
                    msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao deletar esta competência da sua vaga.";
                MsnDanger("Erro", msn);
            }
        });
    }    
    function GetTemplateCompetenciaCorrelataLista()
    {    
		if(Vazio(templatecompetenciacorrelatalista))
        {
            templatecompetenciacorrelatalista = $("#OcultarCompetenciaCorrelataLista").html();
        }
        return templatecompetenciacorrelatalista;
    }
    function AdicionarCompetenciaCorrelataLista(competenciacorrelata = null)
    {
        let nome = "#Competencia";
        let obj = $("#contenersetores #ULsetor1");
        let caixa = GetTemplateCompetenciaCorrelataLista();
        if(Vazio(obj))
        {
            html = $("#OcultarSetor").html();
            html = html.replaceAll("<!--", "").replaceAll("-->", "");
            $("#contenersetores").html(html);
            obj = $("#contenersetores #ULsetor1");
            obj.css("display","block");
        }
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
        caixa = caixa.replaceAll("{idcompetenciacorrelata}", competenciacorrelata.idcompetenciacorrelata);
        caixa = caixa.replaceAll("{idcompetencia}", competenciacorrelata.idcompetencia);
        caixa = caixa.replaceAll("{idarea}", competenciacorrelata.idarea);
        caixa = caixa.replaceAll("{competencia}", competenciacorrelata.competencia);
        caixa = caixa.replaceAll("{checked}", competenciacorrelata.checked);
        obj.append(caixa);
    }
    function CarregarMaisCompetenciaCorrelataLista(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaiscompetenciacorrelata");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
            "somarcado": 0
        };
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarCompetenciaCorrelataLista(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMaisCompetenciaCorrelataLista(data.posicao, data.total);
                    }
                    else
                    {
                        Marcando();
                    }
                    AjustaModal();
                }
                else
                {
                    console.log(data);
                    /*msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);*/
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de cidade.";
                MsnDanger("Erro", msn);
            }
        });
    }    
    function ShowLista()
    {
        let msn = "Você pode escolher quais competências os candidatos devem ter para satisfazer a posição.";
        $("#modalcadastro .tela h3").html(msn);
        $("#modalcadastro").css("display","block");
        $("#modalcadastro #btn-add-empresa").html("Adicionar competências");
        msn = '<i class="fa fa-search"></i> Filtro de competências';
        $("#modalcadastro .tela .filtro button").html(msn);
        CarregarMaisCompetenciaCorrelataLista();
        AjustaModal();
        $('html, body').animate({ scrollTop: 0 }, 800);
    }    
    function FiltroLista()
    {
        let nome = "#contenersetores ul li.bola";
        let filtro = $("#filtroempresa").val();
        if(Vazio(filtro))
        {
            $(nome).each(function( index){
                $(this).removeClass("ocultar");
            });
            nome = "#contenersetores ul";
            $(nome).each(function( index){            
                let ul = $(this);
                let caixa = $(this).parent();
                let total = 0;
                let link = null;
                caixa.css("display","block");
                titulo = "Fechar lista de empresas";
                link = caixa.find(".box a");
                link.attr("title", titulo);
                link.removeClass("up").addClass("down");
                ul.removeClass("up").addClass("down");
            });
        }
        else
        {
            filtro = filtro.toLowerCase();
            $(nome).each(function( index){
                let empresa = $(this).data("competencia").toLowerCase();
                let ul = $(this).parent();
                let caixa = $(this).parent().parent();
                let total = 0;
                if(empresa.search(filtro) >= 0)
                {
                    $(this).removeClass("ocultar");
                }
                else
                {
                    $(this).addClass("ocultar");
                }
            });
            nome = "#contenersetores ul";
            $(nome).each(function( index){            
                let ul = $(this);
                let caixa = $(this).parent();
                let total = 0;
                let link = null;
                total = ul.find("li.bola:not('.ocultar')").length;            
                if(total == 0)
                {
                    caixa.css("display","none");
                }
                else
                {
                    caixa.css("display","block");
                    titulo = "Fechar lista de competências";
                    link = caixa.find(".box a");console.log(link);
                    link.attr("title", titulo);
                    link.removeClass("up").addClass("down");
                    ul.removeClass("up").addClass("down");
                }
            });
        }
        AjustaModal();
    } 
    function CloseLista()
    {
        $("#modalcadastro").css("display","none");
        $("#modalcadastro #contenersetores").html("");
        $("#modalcadastro #btn-add-empresa").html("Adicionar empresas");
    }        
    function AjustaModal()
    {
        let altura = $("#modalcadastro .tela").outerHeight( true );
        let alturabody = $("body").outerHeight( true );
        altura += 50;
        if(altura > alturabody)
            $("#modalcadastro").css("height", altura+"px");
        else
            $("#modalcadastro").css("height", "100%");
        console.log(altura);
    }    
    function SalvarListaDeEmpresas()
    {
        let nome = "#contenersetores ul li input[type='checkbox']:checked";
        $(nome).each(function( index ) {
            let competencia = null;
            let id = $(this).val();
            competencia = {
                "competencia": $("li#Competencia"+id).data("competencia"),
                "idcompetencia": id,
                "idcompetenciacorrelata": 0
            }
            AdicionarCompetenciaCorrelata(competencia);
        });
        CloseLista();
    }
    function AdicionarEmpresaLista(empresa = null)
    {      
		if(Vazio(empresa))
        {
            return;
        }
        let obj = $("#contenersetores #ULsetor"+empresa.idsetor);
        let caixa = GetTemplateEmpresaLista();
        if(Vazio(obj))
        {
            AdicionarSetor(empresa);
            obj = $("#contenersetores #ULsetor"+empresa.idsetor);
        }
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
		caixa = caixa.replaceAll("{idempresatarget}", empresa.idempresatarget);
        caixa = caixa.replaceAll("{idsetor}", empresa.idsetor);
        caixa = caixa.replaceAll("{idempresa}", empresa.id);
        caixa = caixa.replaceAll("{empresa}", empresa.empresa);        
        caixa = caixa.replaceAll("{checked}", empresa.checked);
        obj.append(caixa);
    }
    function Marcando()
    {
        $("#contenercompetencias div.bola").each(function( index ) {
            let id = GetNumero(this.id);
            let idcompetencia = $("#contenersetores #idcompetencia"+id+":checked").val();
            if(Vazio(idcompetencia))
            {
                $("#contenersetores #idcompetencia" + id).get(0).checked = true;
            }
        });
    }
    $(function() {
        formatDecimal($("#faixaderemuneracaoinicial").get(0), "pt-br", true);
        formatDecimal($("#faixaderemuneracaofim").get(0), "pt-br", true);
        $("#idcargo").select2({
            placeholder: '<?php echo __("-- Selecione --"); ?>',
            minimumInputLength: 1,
            language: {
                inputTooShort: function () {
                    return "Você deve inserir mais caracteres ...";
                }
            },
            multiple: true,
            width: '100%',
            ajax: {
                url: GetUrlAcao("api","buscarfiltrosdecargos"),
                dataType: 'json',
                data: function (params) {
                    var query = {
                        search: params.term
                    }
                    return query;
                },
                processResults: function(data) {
                    return { results: data };
                }
            },
            escapeMarkup: function(markup) { return markup; },
            templateResult: function(row) {
                if (row.loading) {
                    return row.text;
                }
                //console.log(row);
                var markup = "<table class='movie-result'><tr>";
                markup += "<td class='movie-info'><div class='movie-title'>" + row.text + "</div>";
                markup += "</td></tr></table>";
                return markup;
            },/*
                templateSelection: function(repo) {console.log(repo);
                    return $(repo.text);
                }*/
        });
        $("#idestado").change(function() {
            let url = GetUrlAcao("api","listacidades");
            let data = null;
            let idestado = $(this).val();
            let msn = "";
            if(Vazio(idestado))
            {
                return;
            }
            data = {
                "idestado":idestado
            }    
            $.ajax({
                url: url,
                method:'POST',
                data:data,
                success:function(data){
                    if(data.sucesso)
                    {
                        let html = '<option value=""><?php echo __("-- Selecione --"); ?></option>';
                        if(!Vazio(data.lista))
                        {
                            for( let i = 0; i < data.lista.length; i++)
                            {
                                id = data.lista[i].id;
                                texto = data.lista[i].texto;
                                html += `<option value="${id}">${texto}</option>`;
                            }
                        }
                        $("#idcidade").html(html);
                    }
                    else
                    {
                        let html = '<option value=""><?php echo __("-- Selecione --"); ?></option>';
                        $("#idcidade").html(html);
                    }
                },
                error: function(XHR, textStatus, errorThrown){
                    msn = "Falha ao buscar lista de cidade.";
                    MsnDanger("Erro", msn);
                }
            });
        });        
        CarregarMaisCargo();
        CarregarMaisSubareaVaga( 0, 0);
        CarregarMaisCompetenciaCorrelata( 0, 0);
    });
</script>