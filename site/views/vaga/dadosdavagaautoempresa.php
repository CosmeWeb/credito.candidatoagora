<section class="container">
    <div class="tituloconteudo">
        <h1><?php echo $obj->titulodavaga; ?></h1>
        <svg id="progress-steps" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 705 26">
            <defs>
                <linearGradient id="linear-gradient" x1="1" y1="1" x2="0" y2="1" gradientUnits="objectBoundingBox">
                <stop offset="0" stop-color="#116cdd"/>
                <stop offset="1" stop-color="#116cdd" stop-opacity="0"/>
                </linearGradient>
            </defs>
            <g id="Group_2942" data-name="Group 2942" transform="translate(-670 -106)">
                <g id="progress-steps" transform="translate(670 106)">
                <g id="step3" transform="translate(420.819 -6)">
                    <g id="Ellipse" transform="translate(6.181 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_4" data-name="4" transform="translate(19.181 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">4</tspan></text>
                </g>
                <g id="step3-2" data-name="step3" transform="translate(164.819 -6)">
                    <g id="Ellipse-2" data-name="Ellipse" transform="translate(136.181 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_3" data-name="3" transform="translate(149.181 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">3</tspan></text>
                </g>
                <g id="step3-3" data-name="step3" transform="translate(503.819 -6)">
                    <g id="Ellipse-3" data-name="Ellipse" transform="translate(49.181 6)" fill="#116cdd" stroke="#116cdd" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_5" data-name="5" transform="translate(62.181 24)" fill="#fff" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">5</tspan></text>
                </g>
                <g id="step3-4" data-name="step3" transform="translate(168.603 -6)">
                    <g id="Ellipse-4" data-name="Ellipse" transform="translate(6.397 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_2" data-name="2" transform="translate(19.397 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">2</tspan></text>
                </g>
                <g id="step3-5" data-name="step3" transform="translate(43.001 -6)">
                    <g id="Ellipse-5" data-name="Ellipse" transform="translate(5.999 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_1" data-name="1" transform="translate(18.999 24)" fill="#a5a4bf" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">1</tspan></text>
                </g>
                <g id="step4" transform="translate(673 -6)">
                    <g id="Ellipse-6" data-name="Ellipse" transform="translate(6 6)" fill="none" stroke="#a5a4bf" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                    </g>
                    <text id="_6" data-name="6" transform="translate(19 24)" fill="#a5a4bf" stroke="rgba(0,0,0,0)" stroke-miterlimit="10" stroke-width="1" font-size="16" font-family="SourceSansPro-Bold, Source Sans Pro" font-weight="700"><tspan x="-4.256" y="0">6</tspan></text>
                </g>
                <rect id="Rectangle_1763" data-name="Rectangle 1763" width="100" height="2" transform="translate(75 12)" fill="#116cdd"/>
                <rect id="Rectangle_1767" data-name="Rectangle 1767" width="49" height="2" transform="translate(0 12)" fill="url(#linear-gradient)"/>
                <rect id="Rectangle_1765" data-name="Rectangle 1765" width="100" height="2" transform="translate(327 12)" fill="#116cdd"/>
                <rect id="Rectangle_2042" data-name="Rectangle 2042" width="100" height="2" transform="translate(201 12)" fill="#116cdd"/>
                <rect id="Rectangle_1766" data-name="Rectangle 1766" width="100" height="2" transform="translate(453 12)" fill="#116cdd"/>
                <rect id="Rectangle_2043" data-name="Rectangle 2043" width="100" height="2" transform="translate(579 12)" fill="#a5a4bf" opacity="0.5"/>
                </g>
                <g id="progress-completed" transform="translate(971 106)">
                <g id="Ellipse-7" data-name="Ellipse" fill="#f0f0f7" stroke="#116cdd" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                </g>
                <path id="Path_294" data-name="Path 294" d="M1187.471,717.879l4.9,4.833,8.407-8.4" transform="translate(-1181 -705)" fill="none" stroke="#116cdd" stroke-width="2"/>
                </g>
                <g id="progress-completed-2" data-name="progress-completed" transform="translate(845 106)">
                <g id="Ellipse-8" data-name="Ellipse" fill="#f0f0f7" stroke="#116cdd" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                </g>
                <path id="Path_294-2" data-name="Path 294" d="M1187.471,717.879l4.9,4.833,8.407-8.4" transform="translate(-1181 -705)" fill="none" stroke="#116cdd" stroke-width="2"/>
                </g>
                <g id="progress-completed-3" data-name="progress-completed" transform="translate(1097 106)">
                <g id="Ellipse-9" data-name="Ellipse" fill="#f0f0f7" stroke="#116cdd" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                </g>
                <path id="Path_294-3" data-name="Path 294" d="M1187.471,717.879l4.9,4.833,8.407-8.4" transform="translate(-1181 -705)" fill="none" stroke="#116cdd" stroke-width="2"/>
                </g>
                <g id="progress-completed-4" data-name="progress-completed" transform="translate(719 106)">
                <g id="Ellipse-10" data-name="Ellipse" fill="#f0f0f7" stroke="#116cdd" stroke-width="2">
                    <circle cx="13" cy="13" r="13" stroke="none"/>
                    <circle cx="13" cy="13" r="12" fill="none"/>
                </g>
                <path id="Path_294-4" data-name="Path 294" d="M1187.471,717.879l4.9,4.833,8.407-8.4" transform="translate(-1181 -705)" fill="none" stroke="#116cdd" stroke-width="2"/>
                </g>
            </g>
        </svg>
    </div>
    <div class="telaestrutura">
        <div class="painelPrincipal">
            <div class="cardconteudo">
                <form id="frmvaga" action="<?php echo site_url('vaga/dadosdavaga') ?>" method="POST">
                    <input id="idvaga" name="idvaga" type="hidden" value="<?php echo $obj->idvaga; ?>">
                    <input id="idcliente" name="idcliente" type="hidden" value="<?php echo $obj->idcliente; ?>">
                    <input id="selecionarempresas" name="selecionarempresas" type="hidden" value="<?php echo $obj->selecionarempresas; ?>">
                    <input id="fasecadastro" name="fasecadastro" type="hidden" value="7">                    
                    <div id="dadosform" class="corpoconteudo">
                        <div class="texto">
                            <h2>Empresas target dentro dos setores já definidos na busca</h2> 
                            <div class="caixa full" style="margin-bottom: 10px;">
                               <div id="EmpresaAuto">
                                    <img src="<?php echo base_url('assets/img/sistema/icone_autoempresas.png') ?>"/>
                                    <div>
                                    Você optou pela seleção de empresas feita com ajuda dos nossos especialistas!
                                    </div>
                               </div>
                            </div>
                            <ol>
                                <li class="titulo">
                                    Excluir candidatos que já tenham trabalhado na empresa contratante no passado?
                                </li>
                                <li class="sim">
                                    <input id="excluirprofissionaisjatrabalhouempresasim" name="excluirprofissionaisjatrabalhouempresa" type="radio" value="Sim" <?php echo $obj->FormGetRadio("excluirprofissionaisjatrabalhouempresa","Sim"); ?>>
                                    <span>Sim</span>
                                </li>
                                <li class="indiferente">
                                    <input id="excluirprofissionaisjatrabalhouempresanao" name="excluirprofissionaisjatrabalhouempresa" type="radio" value="Não" <?php echo $obj->FormGetRadio("excluirprofissionaisjatrabalhouempresa","Não"); ?>>
                                    <span>Não</span>
                                </li>
                            </ol>
                        </div>
                    </div>
                </form>
            </div>
            <div id="dadosformrodape" class="rodapeconteudo">
                <div class="area-btn">
                    <a href="javascript:;" class="btn-Voltar" onclick="Voltar()">Voltar</a>
                    <a href="javascript:;" class="btn-Avancar" onclick="SalvarVaga()">Salvar e Avançar</a>
                </div>
            </div>
        </div>
        <div class="textoAjuda cardEstrutura">
            <h2>Selecionaremos as empresas para você!</h2>
            <p>Ótimo! Vamos envolver nossos especialistas em seleção para sugerir empresas que façam sentindo considerando os setores target que selecionou, o setor atual da sua empresa, porte e momento da empresa.</p>
            <p><b>Uma coisa importante:</b> ao seguir com essa opção e caso os candidatos não sejam exatamente o que você esperava não será possível alterar depois, ok? Aí nesse caso precisa abrir uma nova vaga e informar uma lista de empresas para considerarmos.</p>
            <p>Em caso de dúvidas no preenchimento deste formulário você pode nos contatar no <a href="mailto:ajuda@candidatoagora.com.br">ajuda@candidatoagora.com.br</a>. <br/>Retornaremos o contato em breve.</p>
        </div>
    </div>
</section>
<div id="OcultarSetor" style="display: none;">
<!--
<div id="caixasetor{idsetor}">
    <div class="box">
        <input id="idsetorbox{idsetor}" name="idsetorbox[]" type="checkbox" value="{idsetor}" onchange="MacarAll(this, {idsetor})">
        <samp>{setor}</samp>
        <a href="javascript:;" class="up" title="Abrir lista de empresas" data-idsetor="{idsetor}" onclick="ShowSetores(this, {idsetor});">Voltar</a>
    </div>
    <ul id="ULsetor{idsetor}" class="up">
    </ul>
</div>
-->
</div>
<div id="OcultarEmpresa" style="display: none;">
<!--
<div id="UL{idempresa}" class="bola">
    <input id="idempresatarget{idempresa}" name="idempresatarget[{idempresa}]" type="hidden" value="{idempresatarget}">
    <input id="idempresa{idempresa}" name="idempresa[]" type="hidden" value="{idempresa}">
    <input id="idsetor{idempresa}" name="idsetor[]" type="hidden" value="{idsetor}">
    <span>
        {empresa}
    </span>
    <a href="javascript:;" class="btn-close" onclick="DeleteEmpresaTarget(this, {idempresatarget})"><i class="fa fa-remove"></i></a>
</div>
-->
</div>
<div id="OcultarEmpresaLista" style="display: none;">
<!--
<li id="empresa{idempresa}" class="bola" data-empresa="{empresa}">
    <input id="idempresatarget{idempresa}" name="idempresatarget[{idempresa}]" type="hidden" value="{idempresatarget}">
    <input id="idempresa{idempresa}" name="idempresa[]" type="checkbox" {checked} value="{idempresa}">
    <input id="idsetor{idempresa}" name="idsetor[]" type="hidden" value="{idsetor}">
    <span>
        {empresa}
    </span>
</li>
-->
</div>
<div id="OcultarEmpresaCorrelata" style="display: none;">
<!--
<div class="bola" id="Empresa{cont}">
    <input id="idempresacorrelata{cont}" name="idempresacorrelata[]" type="hidden" value="{idempresacorrelata}">
    <input id="empresa{cont}" name="empresa[]" type="hidden" value="{empresa}">
    <span>{empresa}</span>
    <a href="javascript:;" class="btn-close" onclick="DeletarEmpresaCorrelata(this, {idempresacorrelata})"><i class="fa fa-remove"></i></a>
</div>
-->
</div>
<script>
    var templatesetor = null;
    var templateempresa = null;
    var templateempresalista = null;
    var templateempresacorrelata = null;
    function GetTemplateSetor()
    {    
		if(Vazio(templatesetor))
        {
            templatesetor = $("#OcultarSetor").html();
        }
        return templatesetor;
    }
    function GetTemplateEmpresa()
    {    
		if(Vazio(templateempresa))
        {
            templateempresa = $("#OcultarEmpresa").html();
        }
        return templateempresa;
    }
    function GetTemplateEmpresaLista()
    {    
		if(Vazio(templateempresalista))
        {
            templateempresalista = $("#OcultarEmpresaLista").html();
        }
        return templateempresalista;
    }
    function GetTemplateEmpresaCorrelata()
    {    
		if(Vazio(templateempresacorrelata))
        {
            templateempresacorrelata = $("#OcultarEmpresaCorrelata").html();
        }
        return templateempresacorrelata;
    }
    function ShowSetores(obj, id)
    {
        let titulo = "";
		let status = $(obj).attr("class");
        if(status == "up")
        {
            titulo = "Fechar lista de empresas";
            $(obj).attr("title", titulo);
            $(obj).removeClass("up").addClass("down");
            $("#ULsetor"+id).removeClass("up").addClass("down");
        }
        else
        {
            titulo = "Abrir lista de empresas";
            $(obj).attr("title", titulo);
            $(obj).removeClass("down").addClass("up");
            $("#ULsetor"+id).removeClass("down").addClass("up");
        }
        AjustaModal();
    }
    function AdicionarSetor(setor = null)
    {
        let obj = $("#contenersetores");        
		if(Vazio(setor))
        {
            return;
        }
        let caixa = GetTemplateSetor();
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
        caixa = caixa.replaceAll("{idsetor}", setor.idsetor);
        caixa = caixa.replaceAll("{setor}", setor.setor);
        obj.append(caixa);
    }
    function AdicionarEmpresa(empresa = null, exibererro = true)
    {      
		if(Vazio(empresa))
        {
            return;
        }
        let obj = $("#contenerempresas #UL"+empresa.id);
        let caixa = GetTemplateEmpresa();
        if(!Vazio(obj))
        {
            if(exibererro)
            {
                msn = 'Empresa já está incluida na lista.';
                titulo = "Atenção!";
                MsnDanger(titulo, msn);
            }
            return;
        }
        obj = $("#contenerempresas");
        obj.parent().css('display','block');
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
		caixa = caixa.replaceAll("{idempresatarget}", empresa.idempresatarget);
        caixa = caixa.replaceAll("{idsetor}", empresa.idsetor);
        caixa = caixa.replaceAll("{idempresa}", empresa.id);
        caixa = caixa.replaceAll("{empresa}", empresa.empresa);
        obj.append(caixa);
    }
    function AdicionarEmpresaLista(empresa = null)
    {      
		if(Vazio(empresa))
        {
            return;
        }
        let obj = $("#contenersetores #ULsetor"+empresa.idsetor);
        let caixa = GetTemplateEmpresaLista();
        if(Vazio(obj))
        {
            AdicionarSetor(empresa);
            obj = $("#contenersetores #ULsetor"+empresa.idsetor);
        }
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
		caixa = caixa.replaceAll("{idempresatarget}", empresa.idempresatarget);
        caixa = caixa.replaceAll("{idsetor}", empresa.idsetor);
        caixa = caixa.replaceAll("{idempresa}", empresa.id);
        caixa = caixa.replaceAll("{empresa}", empresa.empresa);        
        caixa = caixa.replaceAll("{checked}", empresa.checked);
        obj.append(caixa);
    }
    function AdicionarEmpresaCorrelata(empresa = null)
    {      
        let obj = $("#areaempresa div:last-of-type");
        let id = 0;
        if(Vazio(obj))
        {
            id = 0;
        }
        else
        {
            id = obj.attr('id');
            id = GetNumero(id);
            id++;
		}
		if(Vazio(empresa))
        {
            let nome = $("#nomeempresa").val();
            if(Vazio(nome))
            {
                return;
            }
            empresa = {
                "idempresacorrelata":0,
                "idvaga": 0,
                "empresa": nome
            };
            $("#nomeempresa").val("");
        }
        obj = $("#areaempresa");  
        let caixa = GetTemplateEmpresaCorrelata();
        if(Vazio(obj))
        {
            return;
        }
        obj.css("display","block");
        caixa = caixa.replaceAll("{cont}", id);
        caixa = caixa.replaceAll("<!--", "");
		caixa = caixa.replaceAll("-->", "");
		caixa = caixa.replaceAll("{idempresacorrelata}", empresa.idempresacorrelata);
        caixa = caixa.replaceAll("{empresa}", empresa.empresa);
        obj.append(caixa);
    }
    function MacarAll(obj, id)
    {
        let nome = "#caixasetor"+id+" #ULsetor"+id+" li input[type='checkbox']";
        if(Vazio(obj))
        {
            return;
        }
        if(obj.checked)
        {
            nome = "#caixasetor"+id+" #ULsetor"+id+" li:not('.ocultar') input[type='checkbox']";
            $(nome).each(function( index ) {
                this.checked = true;
            });
        }
        else
        {
            $(nome).each(function( index ) {
                this.checked = false;
                $(this).trigger("change");
            });
        }
    }
    function FiltroLista()
    {
        let nome = "#contenersetores ul li.bola";
        let filtro = $("#filtroempresa").val();
        if(Vazio(filtro))
        {
            $(nome).each(function( index){
                $(this).removeClass("ocultar");
            });
            nome = "#contenersetores ul";
            $(nome).each(function( index){            
                let ul = $(this);
                let caixa = $(this).parent();
                let total = 0;
                let link = null;
                caixa.css("display","block");
                titulo = "Fechar lista de empresas";
                link = caixa.find(".box a");
                link.attr("title", titulo);
                link.removeClass("up").addClass("down");
                ul.removeClass("up").addClass("down");
            });
        }
        else
        {
            filtro = filtro.toLowerCase();
            $(nome).each(function( index){
                let empresa = $(this).data("empresa").toLowerCase();
                let ul = $(this).parent();
                let caixa = $(this).parent().parent();
                let total = 0;
                if(empresa.search(filtro) >= 0)
                {
                    $(this).removeClass("ocultar");
                }
                else
                {
                    $(this).addClass("ocultar");
                }
            });
            nome = "#contenersetores ul";
            $(nome).each(function( index){            
                let ul = $(this);
                let caixa = $(this).parent();
                let total = 0;
                let link = null;
                total = ul.find("li.bola:not('.ocultar')").length;            
                if(total == 0)
                {
                    caixa.css("display","none");
                }
                else
                {
                    caixa.css("display","block");
                    titulo = "Fechar lista de empresas";
                    link = caixa.find(".box a");console.log(link);
                    link.attr("title", titulo);
                    link.removeClass("up").addClass("down");
                    ul.removeClass("up").addClass("down");
                }
            });
        }
        AjustaModal();
    }    
    function SalvarListaDeEmpresas()
    {
        let nome = "#contenersetores ul li input[type='checkbox']:checked";
        $(nome).each(function( index ) {
            let empresa = null;
            let id = $(this).val();
            empresa = {
                "empresa": $("li#empresa"+id).data("empresa"),
                "id": id,
                "idempresatarget": $("li.bola #idempresatarget"+id).val(),
                "idsetor":  $("li.bola #idsetor"+id).val(),
                "setor": "",
               "checked": "",
            }
            AdicionarEmpresa(empresa, false);
        });
        CloseLista();
    }
    function CarregarMais(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaisempresas");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
            "somarcado": 1
        };
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarEmpresa(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMais(data.posicao, data.total);
                    }
                }
                else
                {
                    console.log(data);
                    /*msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);*/
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de cidade.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function CarregarMaisEmpresa(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaisempresascorrelata");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
        };
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarEmpresaCorrelata(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMaisEmpresa(data.posicao, data.total);
                    }
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de empresa.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function CarregarMaisEmpresaLista(posicao = 0, total = 0)
    {
        let url = GetUrlAcao("api","carregarmaisempresas");
        let data = null;
        data = {
            "posicao": posicao,
            "total": total,
            "idvaga": $("#idvaga").val(),
            "somarcado": 0
        };
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    if(!Vazio(data.lista))
                    {
                        for( let i = 0; i < data.lista.length; i++)
                        {
                            AdicionarEmpresaLista(data.lista[i]);
                        }
                    }
                    if(!data.finalizar)
                    {
                        CarregarMaisEmpresaLista(data.posicao, data.total);
                    }
                    else
                    {
                        Marcando();
                    }
                    AjustaModal();
                }
                else
                {
                    console.log(data);
                    /*msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);*/
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de cidade.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function DeleteEmpresaTarget(obj, idempresatarget)
    {
        let url = GetUrlAcao("api","deleteempresatarget");
        let data = null;
        if(Vazio(idempresatarget))
        {
            $(obj).parent().remove();
            return;
        }
        data = {
            "idempresatarget":idempresatarget
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    $(obj).parent().remove();
                    msn = data.mensagem;
                    titulo = data.titulo;
                    MsnSucesso(titulo, msn);
                }
                else
                {
                    msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao buscar lista de cidade.";
                MsnDanger("Erro", msn);
            }
        });
    }
    function DeletarEmpresaCorrelata(obj, idempresacorrelata)
    {
        let url = GetUrlAcao("api","deleteempresacorrelata");
        let data = null;
        if(Vazio(idempresacorrelata))
        {
            $(obj).parent().remove();
            return;
        }
        if(!confirm("<?php echo __("Tem certeza que deseja deletar esta empresa da sua vaga?"); ?>"))
        {
            return;
        }
        data = {
            "idempresacorrelata":idempresacorrelata
        }    
        $.ajax({
            url: url,
            method:'POST',
            data:data,
            success:function(data){
                if(data.sucesso)
                {
                    $(obj).parent().remove();
                    msn = data.mensagem;
                    titulo = data.titulo;
                    MsnSucesso(titulo, msn);
                }
                else
                {
                    msn = data.erro;
                    titulo = data.titulo;
                    MsnDanger(titulo, msn);
                }
            },
            error: function(XHR, textStatus, errorThrown){
                msn = "Falha ao deletar esta empresa da sua vaga.";
                MsnDanger("Erro", msn);
            }
        });
    }    
    function AbrirEmpresaCorrelata(obj)
    {
        if((!Vazio(obj.checked))&&(obj.value == "Sim"))
        {
            $(listaempresa).slideDown("slow");
        }
        else
        {            
            $(listaempresa).slideUp("slow");
        }
    }    
    function ShowLista()
    {
        let msn = "Você pode escolher apenas os setores target ou também empresas dentro dos setores já definidos.";
        $("#modalcadastro .tela h3").html(msn);
        $("#modalcadastro").css("display","block");        
        $("#modalcadastro #contenersetores").removeClass("excluir");
        CarregarMaisEmpresaLista();
        AjustaModal();
        $('html, body').animate({ scrollTop: 0 }, 800);
    }
    function CloseLista()
    {
        $("#modalcadastro").css("display","none");
        $("#modalcadastro #contenersetores").html("");
    }        
    function AjustaModal()
    {
        let altura = $("#modalcadastro .tela").outerHeight( true );
        let alturabody = $("body").outerHeight( true );
        altura += 50;
        if(altura > alturabody)
            $("#modalcadastro").css("height", altura+"px");
        else
            $("#modalcadastro").css("height", "100%");
        console.log(altura);
    }
    function Marcando()
    {
        $("#contenerempresas div.bola").each(function( index ) {
            let id = GetNumero(this.id);
            let idempresatarget = $("#contenerempresas #idempresatarget"+id).val();
            if(Vazio(idempresatarget))
            {
                $("#contenersetores #idempresa" + id).get(0).checked = true;
            }
        });
    }
    $(function() {
        CarregarMais();
        CarregarMaisEmpresa();
        $("input[name='incluirempresasforatarget']").change(function () {
            AbrirEmpresaCorrelata(this);
        });
        $("input[name='incluirempresasforatarget']:checked").each(function( index ) {
            AbrirEmpresaCorrelata(this);
        });
        $("#empresatarget").select2({
            placeholder: '<?php echo __("-- Selecione --"); ?>',
            minimumInputLength: 1,
            language: {
                inputTooShort: function () {
                    return "Você deve digitar o nome empresa...";
                }
            },
            width: '60%',
            ajax: {
                url: GetUrlAcao("api","buscarfiltrosdeempresas"),
                dataType: 'json',
                data: function (params) {
                    var query = {
                        "search": params.term,
                        "idvaga": $("#idvaga").val(),
                    }
                    return query;
                },
                processResults: function(data) {
                    return { results: data };
                }
            },
            escapeMarkup: function(markup) { return markup; },
            templateResult: function(row) {
                if (row.loading) {
                    return row.empresa;
                }
                //console.log(row);
                var markup = "<table class='movie-result'><tr>";
                markup += "<td class='movie-info'><div class='movie-title'>" + row.empresa + "</div>";
                markup += "</td></tr></table>";
                return markup;
            },
            templateSelection: function(state)
            {
                if (!state.id) {
                    return state.empresa;
                }
                console.log(state);
                return "";
            }
        }).on('select2:select', function(e) {
            let empresa = e.params.data;
            console.log(e, empresa);
            AdicionarEmpresa(empresa);
        });
        SetabloquearCopia();
    });
</script>

